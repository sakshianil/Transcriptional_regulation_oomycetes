# Code Documentation

## Introduction

This document provides a comprehensive guide to all code scripts used in the transcriptional regulation project in oomycetes. Each script in this repository is designed to perform a specific function within the computational workflows for data analysis, visualization, and interpretation. This guide will help users understand what each script does, how to execute it, and the dependencies needed for successful implementation.

## Directory Structure
The code for this project is organized in the following directory structure:

- **`R/`**: Contains R scripts for statistical analysis and data visualization.
  - **`Pl_halstedii_study/`**: Scripts related to Plasmopara halstedii study.
    - **`1.2_DGE_analysis.R`**: Performs differential gene expression analysis and clustering of time-series data.

- **`perl/`**: Perl scripts for specific file parsing, extraction, and sequence manipulation.
  - **`fasta-get-markov.pl`**: Generates Markov models from FASTA files for background correction (Source: https://meme-suite.org/meme/doc/fasta-get-markov.html). This script has been used for generating markov models for **`Pl_halstedii study/`** and **`orthologs_motif_study/`**

- **`python/`**: Python scripts used for various data processing tasks, such as motif extraction, data manipulation, and integration.
  - **`Pl_halstedii_study/`**: Scripts for Plasmopara halstedii analysis.
    - **`1.3_Bg_promoters_search_phal.py`**: Searches for background promoters in Plasmopara halstedii. The output file **`bg_promoter_100.fasta`** is input for script **`fasta-get-markov.pl`** inside perl scripts folder.
    - **`1.4_clusters_Promoters_search_coord.py`**: Searches for promoters based on cluster coordinates generated from R script **`1.2_DGE_analysis.R`**. The results are stored in **`results/python/Pl_halstedii_study/clusters_fasta/`**. (eg. for reference output_1 contains results for cluster number 1).
  
  - **`orthologs_motif_study/`**: Scripts for ortholog analysis.
    - **`2.1_clusters_gene_extractor.py`**: Extracts gene sequences based on clusters information provided by **`1.2_DGE_analysis.R`**. The output generated were used as query against local blastn gene database. 
    - **`2.2_promoter_extractor_from_genome.py`**: Extracts promoter sequences (upstream 400 nucelotides from start codon) of three genomes. The results are stored in **`/results/python/orthologs_motifs_study/bg_promoter_full_400.fasta`**. This file was subject database used for local blastn promoter database.  
    - **`2.3_clusters_promoter_extractor.py`**: Extracts promoter sequences for gene clusters information provided by **`1.2_DGE_analysis.R`**. The output generated were used as query against local blastn promoter database.
    - **`2.4_gene_extractor_from_genome.py`**: Extracts genes from the genome. The same script is used for three genomes by replacing with their respective file names and their paths within the script. The output generated was treated as local blastn gene database.
    - **`validated_effector_genes/`**: Scripts for validated effector gene analysis.
      - **`2.6_fetch_Gene_from_proteinids.py`**: Fetches gene id and sequence information from protein IDs. The protein ids are provided by file 'effectors_blast_results.txt'.The output generated was merged with output of **`gene_extractor_from_genome.py`** and treated as local blastn gene database.
      - **`2.7_fetch_upstream_from_geneid.py`**: Extracts upstream regions based on gene IDs generated by **`fetch_Gene_from_proteinids_editted_genesonly.py`**. The generated FASTA file with upstream sequences and coordinates is **`singleline_upstream_sequences_with_coordinates.fasta`**. This file was merged with output of **`promoter_extractor_from_genome.py`** and treated as local blastn promoter database.

  - **`orthologs_TF_study/`**: Scripts for transcription factoris analysis.
    - **`3.2_extract_jaspar_info.py`**: Extracts information from JASPAR database based on results generated by script **`3.1_motif_analysis_against_jaspar.sh`**.
    - **`3.3_extract_protein_info.py`**: Extracts protein sequence information based on UniProt IDs. The file **`combined_with_profile_summaries.tsv`** is used as input for generating query protein sequences file **`output_query_sequences.fasta`**
    - **`3.4_extract_protein_info_ftfd.py`**: Extracts protein sequences from FTFD database aligned against **`output_query_sequences.fasta`**. The results are stored in  **`output_subject_sequences.fasta`**  

- **`shell/`**: Shell scripts for running automation tasks, including downloading datasets, running pipeline workflows and executing commands sequentially.
  - **`Pl_halstedii_study/`**: Scripts for Plasmopara halstedii analysis.
    - **`1.1_trimming_mapping_host_pathogen.sh`**: First script used on raw/ data for Automating read trimming using Trimmomatic, alignment with STAR and read counting with FeatureCounts.
    - **`1.5_motif_analysis_meme_suite.sh`**: Performs motif analysis on clustered promoter regions using MEME Suite.The results are stored in **`/python/Pl_halstedii_study/clusters_fasta/`**. (eg. for reference output_1 contains MEME suite results for cluster number 1). The combined results are stored in **`/results/meme/Pl_halstedii_study/`**. 
  - **`orthologs_motifs_study/`**: Scripts for ortholog analysis.
    - **`2.8_run_blast_clusters.sh`**: Runs BLAST for gene and promoter clusters. The output from all scripts within **`/scripts/python/orthologs_motif_study/`** and **`/scripts/python/orthologs_motif_study/validated_effector_genes/`** were used to generate the results for clustered gene and promoter sequences.
    - **`2.9_common_upstream.sh`**: Extracts conserved upstream sequences of conserved genes. 
    - **`2.10_common_upstream_fasta.sh`**: Extracts conserved upstream promoter fasta sequences of conserved genees retreived from **`2.8_common_upstream.sh`**. The results for all promoter clusters are stored in clusters folder **`/results/python/orthologs_motifs_study/clusters/`**. All of the clusters fasta is concatenated as **`/results/python/orthologs_motifs_study/bg_promoter_only_aligned.fasta`** for MEME script **`2.10_motif_analysis.sh`**. 
    - **`2.11_motif_analysis.sh`**: Performs motif analysis using MEME suite for orthologs. MEME results for all promoter clusters are stored in clusters folder **`/results/python/orthologs_motifs_study/clusters/`** The combined results are stored in **`/results/meme/orthologs_motifs_study/`**.
    - **`2.12_Category_assignment.sh`**: Assigns categories to motifs based on conservation. The input file is **`/results/meme/orthologs_motifs_study/combined_fimo.tsv`** and results are stored in **`/results/shell/orthologs_motifs_study/categorized_combined_fimo.tsv`**.
    - **`validated_effectors/`**: Scripts for retrieval of validated effector sequences from ncbi.
      - **`2.5_blast_nr.sh`**: Runs BLASTp against the non-redundant (NR) database. The input is **`effector_sequences.fa`** and results are stored in file **`effectors_blast_results.txt`**
  - **`orthologs_TF_study/`**: Scripts for transcription factor study.
    - **`3.1_motif_analysis_against_jaspar.sh`**: Performs motif analysis using TOMTOM of MEME suite. The result are stored in file **`/results/meme/orthologs_TF_study/combined_tomtom.tsv`**.
    - **`3.5_blastp_against_FTFD.sh`**: Sequence alignment of **`output_query_sequences.fasta`** with **`output_subject_sequences.fasta`**. The output is stored in **`/results/shell/orthologs_TF_study/blastp_output.txt`**. The same script can be used for any input query sequences (eg. protein seqeunces those are not having any hits with JASPAR can be aligned against FTFD directly. 

## Script Descriptions

### R Scripts (`R/`)

1. **`DGE_analysis.R`**
   - **Purpose**: Performs differential gene expression analysis using DESeq2.
   - **Dependencies**: Requires R packages like `DESeq2`, `ggplot2`, and `dplyr`.
   - **How to Run**:
     - Make sure all required libraries are installed.
     - Adjust the input file paths within the script to match the processed data folder.
     - Execute using RStudio or from the terminal: `Rscript DGE_analysis.R`.


### Python Scripts (`python/`)

1. **`Bg_promoters_search_phal.py`**
   - **Purpose**: Searches for background promoters in Plasmopara halstedii.
   - **Dependencies**: Requires `Biopython` and `pandas`.
   - **How to Run**:
     - Execute with Python 3 using: `python Bg_promoters_search_phal.py`
     - Provide the appropriate input file paths as arguments or modify the script directly.

2. **`extract_jaspar_info_editted.py`**
   - **Purpose**: Extracts transcription factor binding site information from JASPAR.
   - **Dependencies**: Requires `requests` and `pandas`.
   - **Instructions**: Ensure you have internet access and run: `python extract_jaspar_info_editted.py`.

### Shell Scripts (`shell/`)

1. **`trimming_mapping_host_pathogen.sh`**
   - **Purpose**: Automates read trimming using Trimmomatic, alignment with STAR, and read counting with FeatureCounts.
   - **How to Run**:
     - Set executable permissions using: `chmod +x trimming_mapping_host_pathogen.sh`
     - Execute with: `./trimming_mapping_host_pathogen.sh`
   - **Requirements**: Trimmomatic, STAR, and FeatureCounts must be installed and properly configured in your environment.

2. **`motif_analysis_meme_suite.sh`**
   - **Purpose**: Performs motif discovery analysis using MEME Suite.
   - **Instructions**: Modify input paths to the sequence files and execute.

### Perl Scripts (`perl/`)

1. **`fasta-get-markov.pl`**
   - **Purpose**: Generates Markov models from FASTA files for background correction during motif analysis.
   - **How to Run**: Execute using Perl: `perl fasta-get-markov.pl`
   - **Dependencies**: Perl version 5.10 or higher.

## Code Usage

1. **Environment Setup**
   - Ensure you have installed all necessary software and libraries as described in the [Requirements](../INSTALL.md).
   - Set up environment variables if required for running the scripts, especially for the shell workflows.

2. **Execution**
   - Scripts can be run individually by navigating to the relevant directories.
   - Refer to individual file headers for script-specific details on parameters and input requirements.

3. **Reproducibility**
   - Paths are hardcoded for the user's setup. Modify paths according to your directory structure.
   - Configurable input and output paths allow for reproducibility on different systems.

## Best Practices
- **Documentation**: All scripts include comments to guide users through the logic of the code. Please read these comments for guidance on required inputs and parameters.
- **Versioning**: Ensure that you are using the versions of the required software as mentioned in the [Requirements](../INSTALL.md).
- **Testing**: It is recommended to test the scripts on small sample datasets to verify the expected outcomes before proceeding to the full analysis.

## Code Contribution

If you wish to contribute to the codebase, please follow the guidelines outlined in the [CONTRIBUTING.md](../CONTRIBUTING.md). Contributions to improve efficiency, readability, or add features are welcome.

## Contact
For any questions related to the code or execution steps, please reach out to [Sakshi Bharti](mailto:sakshi.bharti@senckenberg.de).

## License
The code is provided under the MIT License. Refer to the [LICENSE](../LICENSE) file for details.


